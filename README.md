
# AML Engine

This is the RBC test assignment by Waleed Rizk.
This project is an Anti-Money Laundering (AML) system for RBC bank that processes millions of transactions daily. The system is designed to log alerts in real time if an account breaches a threshold of 50,000 USD in a 60-second window.

The system runs on Docker and is a SpringBoot application. This gives the advantages of microservices. The application can run in Kubernetes to allow for scaleability of pods and resiliency.

## Table of Contents

1. [Project Structure](#project-structure)
2. [Getting Started](#getting-started)
3. [Running the Application](#running-the-application)
4. [Configuration](#configuration)
5. [Testing](#testing)
6. [Building the Project](#building-the-project)
7. [How to Change Configuration](#how-to-change-configuration)

## Project Structure

The project follows a standard Maven-based structure:

```
RBCAssignment/
│
├── src/
│   ├── main/
│   │   ├── java/
│   │   │   └── com/rbc/amlengine/
│   │   │       ├── AMLApplication.java         # Main application class
│   │   │       ├── model/
│   │   │       │   └── Transaction.java        # Transaction model
│   │   │       ├── service/
│   │   │       │   ├── TransactionProcessor.java  # Service for processing transactions
│   │   │       │   └── AlertService.java       # Service for generating alerts
│   │   │       └── mapper/
│   │   │           └── TransactionMapper.java  # MapStruct interface for mapping CSV to Transaction object
│   │   └── resources/
│   │       ├── application.properties          # Common configuration file
│   │       ├── application-dev.properties      # Development environment configuration
│   │       ├── application-uat.properties      # UAT environment configuration
│   │       └── application-prod.properties     # Production environment configuration
│   └── test/
│       ├── java/
│       │   └── com/rbc/amlengine/
│       │       └── AMLApplicationTest.java     # Unit tests for AMLApplication
│       └── resources/
│           └── test-transactions.csv           # Test CSV file for unit tests
│
├── target/                                     # Build output directory (generated by Maven)
│
├── pom.xml                                     # Maven build file
└── README.md                                   # Project readme file
```

## Getting Started

### Prerequisites

- Java 17 or later
- Maven 3.6.0 or later

### Installation

Clone the repository and navigate to the project directory:

```bash
git clone https://github.com/WaleedRizk/RBCAssignment.git
cd RBCAssignment
```

#### Summary of Docker Files

Dockerfile: Defines how to build the Docker image for your Java application.
docker-compose.yml: (Optional) Allows you to run your application with multiple services.
.dockerignore: Prevents unnecessary files from being included in the Docker image build.

##### How to Use These Files
Build the Docker Image: Run the following command to build the Docker image:

bash
docker build -t aml-engine .
Run the Docker Container: Run the following command to start a container from the image:

```bash
docker run -p 8080:8080 aml-engine
```

Using Docker Compose: If you have a docker-compose.yml file, use the following command to start all services:

```bash
docker-compose up --build
```

These files should be placed in the root directory of your project, alongside your pom.xml file. You can adjust these files based on your specific requirements and application configuration.

## Running the Application

### Running in Different Environments

The application supports multiple environments, configured through Maven profiles and properties files:

1. **Development** (default)
2. **UAT** (User Acceptance Testing)
3. **Production**

To run the application in different environments, use the following commands:

#### Development

```bash
mvn spring-boot:run -Dspring-boot.run.profiles=dev
```

#### UAT

```bash
mvn spring-boot:run -Dspring-boot.run.profiles=uat
```

#### Production

```bash
mvn spring-boot:run -Dspring-boot.run.profiles=prod
```

### Command-Line Arguments

You can also override the default environment using the `--spring.profiles.active` argument:

```bash
java -jar target/aml-engine.jar --spring.profiles.active=dev
```

## Configuration

The project uses Spring Boot's `application.properties` and environment-specific properties files to configure different settings:

- **`application.properties`**: Shared settings across all environments.
- **`application-dev.properties`**: Settings specific to the development environment.
- **`application-uat.properties`**: Settings specific to the UAT environment.
- **`application-prod.properties`**: Settings specific to the production environment.

### Example Configurations

**application.properties**:

```properties
transaction.threshold=50000.0
time.threshold.seconds=60
csv.file.path=prod-transactions.csv
```

**application-dev.properties**:

```properties
csv.file.path=src/test/resources/dev-transactions.csv
```

**application-uat.properties**:

```properties
csv.file.path=src/test/resources/uat-transactions.csv
```

**application-prod.properties**:

```properties
csv.file.path=src/main/resources/prod-transactions.csv
```

## Testing

### Running Tests

To run the tests, use Maven:

```bash
mvn test
```

### Testing with Different Profiles

You can run tests with different profiles by setting the `spring.profiles.active` property:

```bash
mvn test -Dspring.profiles.active=dev
```

## Building the Project

To build the project, run:

```bash
mvn clean install
```

This will compile the code, run tests, and package the application into a JAR file in the `target` directory.

## How to Change Configuration

1. **Update Environment Properties**: Modify the relevant `application-{profile}.properties` file in the `src/main/resources` directory.
   
2. **Rebuild the Application**: After making changes, rebuild the application using `mvn clean install`.

3. **Deploy or Run**: Deploy the updated JAR or run it locally with the appropriate environment settings.

**Example**: To change the transaction threshold in the development environment, update `application-dev.properties`:

```properties
transaction.threshold=75000.0
```

Then rebuild and run the application with the `dev` profile.

```bash
mvn spring-boot:run -Dspring-boot.run.profiles=dev
```

## Additional Notes

- **Log Configuration**: Logging is configured in `log4j2.xml` (not shown in the structure above).
- **Docker and Kubernetes Support**: Future versions may include Docker and Kubernetes configurations for containerization and orchestration.

Feel free to modify this README to match your specific project needs and environment settings.
